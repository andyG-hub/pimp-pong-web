<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pimp Pong | Leaderboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #0b0b0b; color: white; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #1a1a1a; padding: 25px; border-radius: 20px; border: 1px solid #333; }
        h1 { color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); font-size: 2.5em; margin: 0; }
        input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #444; background: #222; color: white; outline: none; }
        button { width: 95%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 5px; text-transform: uppercase; }
        .btn-reg { background: #ffd700; color: black; }
        #leaderboard { margin-top: 30px; text-align: left; background: #222; padding: 15px; border-radius: 12px; border: 1px solid #333; }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>PIMP PONG üèì</h1>
    <p style="color: #888;">Solana Gold Egg Leaderboard</p>

    <input type="text" id="twitterHandle" placeholder="Your X Name">
    <input type="text" id="walletAddress" placeholder="Solana Wallet Address">
    <button class="btn-reg" onclick="registerUser()">JOIN LEADERBOARD</button>

    <div id="leaderboard">
        <div id="conn-status" style="font-size: 0.8em; margin-bottom: 10px; color: #666;">
            <span class="status-dot" style="background: #666;"></span> Checking API...
        </div>
        <h3 style="margin: 0 0 10px 0; border-bottom: 1px solid #444; padding-bottom: 5px;">Pimps</h3>
        <div id="list">Initialising...</div>
    </div>
</div>

<script>
    // Double check these don't have hidden spaces!
    const SUPABASE_URL = "https://advzccqwmbukvwdpnoef.supabase.co"; 
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkdnpjY3F3mJ1a3Z3ZHBub2VmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNTcyMzcsImV4cCI6MjA4NDkzMzIzN30.9oxdNG93FSeDkng-UXlV0G2XlauQeszW7HLadIuGvqQ"; 
    
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function checkConnection() {
        const { data, error } = await sb.from('gold_eggs_leaderboard').select('count');
        const statusDiv = document.getElementById('conn-status');
        if (error) {
            statusDiv.innerHTML = `<span class="status-dot" style="background: red;"></span> API ERROR: ${error.message}`;
            console.error("Connection Failed:", error);
        } else {
            statusDiv.innerHTML = `<span class="status-dot" style="background: #00ff00;"></span> Connected to Supabase`;
            fetchLeaderboard();
        }
    }

    async function fetchLeaderboard() {
        const { data, error } = await sb.from('gold_eggs_leaderboard').select('*').order('points', { ascending: false });
        if (data) {
            if (data.length === 0) {
                document.getElementById('list').innerHTML = "Leaderboard is empty.";
            } else {
                document.getElementById('list').innerHTML = data.map(u => `
                    <div style="display:flex; justify-content:space-between; padding: 8px 0; border-bottom: 1px solid #333;">
                        <span>${u.twitter_name}</span>
                        <span style="color:#ffd700">${u.points} ü•ö</span>
                    </div>
                `).join('');
            }
        }
    }

    async function registerUser() {
        const twitter_name = document.getElementById('twitterHandle').value.trim();
        const wallet_address = document.getElementById('walletAddress').value.trim();
        if(!twitter_name || !wallet_address) return alert("Fill fields!");
        
        const { error } = await sb.from('gold_eggs_leaderboard').insert([{ twitter_name, wallet_address, points: 0 }]);
        if (error) alert("Error: " + error.message); else fetchLeaderboard();
    }

    checkConnection();
</script>
</body>
</html>
